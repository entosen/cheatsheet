================================
ターミナルでの色
================================



ANSI エスケープシーケンス
================================

参考

- `ANSI escape code - Wikipedia # Colors <https://en.wikipedia.org/wiki/ANSI_escape_code#Colors>`__
- `ANSIエスケープコード - コンソール制御 - 碧色工房 <https://www.mm2d.net/main/prog/c/console-02.html>`__
- `端末の256色と24bitカラー(1677万色)の対応と設定・色指定 - kakurasan <https://kakurasan.blogspot.com/2017/06/term-256-and-16million-colors.html>`__

ANSIエスケープシーケンスの中の CSI (Control Sequence Introducer commands) 、
その中の ``m`` (SGR, Select Graphic Rendition) で色の制御ができる。

::

  ESC [ 32 m         前景色を緑に
  ESC [ 1;31;43 m    ボールド、前景色を赤、背景色を黄色に
  ESC [ 0 m          リセット


=========  ============================================================
n          意味
=========  ============================================================
0          リセット
1          ボールド(太字)、端末によっては色の変化
3          イタリック(斜体)
4          下線
7          反転。前景色と背景色を入れ替え
9          取消線
30〜37     文字色(前景色)指定。
38         文字色(前景色)指定拡張用。256色や24bitカラー。後述。
39         文字色(前景色)をデフォルトに戻す
40〜47     (背景色)指定。
48         (背景色)指定拡張用。256色や24bitカラー。後述。
49         (背景色)をデフォルトに戻す
90〜97     文字色(前景色)指定、30番台の指定より強い色。
100〜107   背景色(前景色)指定、30番台の指定より強い色。
=========  ============================================================


8色, 16色
----------------------

30〜37, 40〜47, 90〜97, 100〜107 で

== ===   ================
FG BG    Name
== ===   ================
30 40    Black 黒
31 41    Red 赤
32 42    Green 緑
33 43    Yellow 黄
34 44    Blue 青
35 45    Magenta 赤紫
36 46    Cyan 水色
37 47    White 白
90 100   Bright Black (グレー)
91 101   Bright Red
92 102   Bright Green
93 103   Bright Yellow
94 104   Bright Blue
95 105   Bright Magenta
96 106   Bright Cyan
97 107   Bright White
== ===   ================

この16色が実際にどういう色で表示されるかは、端末エミュレーターの設定による。

Bold指定したときに、太字にするだけでなく/太字にせずに、Brightの色にする端末もある。




256色 (8bit カラー)
-----------------------

SGR の 38番(前景色)、48番(背景色) で ``5;n`` の書き方をすることで 256色の指定ができる

::

  ESC [ 38;5;214 m     前景色を 214番(オレンジ)に
  ESC [ 48;5;22 m      前景色を 22番(暗めの緑)に


色番号(カラーパレット)は下記のような感じになっている。

::

  ESC[38;5;⟨n⟩m Select foreground color      where n is a number from the table below
  ESC[48;5;⟨n⟩m Select background color

    0-  7:  standard colors (as in ESC [ 30-37 m)            # 基本色8色
    8- 15:  high intensity colors (as in ESC [ 90-97 m)      # 明るい色8色
   16-231:  6 × 6 × 6 cube (216 colors):
              16 + 36 × r + 6 × g + b (0 ≤ r, g, b ≤ 5)  # 有彩色

  232-255:  grayscale from dark to light in 24 steps         # グレースケール


有彩色の r,g,b の 0〜5 は均等ではないっぽい。
レベル1で一気に95(0x5F)が加算され、以降 40(0x28)が加算されるらしい。(xterm?)

- `ターミナルの256色について、改めて確認しましょう #Bash - Qiita <https://qiita.com/Dooteeen/items/871f6804f5265e2baba8#%E6%9C%89%E5%BD%A9%E8%89%B2%E3%82%BE%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6>`__

::

  レベル 10進 16進      %
  0         0    0     0.0
  1        95   5F    37.3
  2       135   87    52.9
  3       175   AF    68.6
  4       215   D7    84.3
  5       255   FF   100.0

グレースケースの部分の階調は下記::

  0x08,0x12,0x1c,0x26,0x30,0x3a,0x44,0x4e,
  0x58,0x62,0x6c,0x76,0x80,0x8a,0x94,0x9e,
  0xa8,0xb2,0xbc,0xc6,0xd0,0xda,0xe4,0xee



TODO

この8bitカラーパレットの割り当てを変えることができる？

::

  (赤・緑・青それぞれの値を分けて指定する形)
  bash/zsh$ printf "\e]4;17;rgb:fe/cc/f0\a"

  (6桁の16進表記を用いて指定する形)
  bash/zsh$ printf "\e]4;17;#feccf0\a"




True Color 24bitカラー
--------------------------

SGR の 38番(前景色)、48番(背景色) で ``2;r;g;b`` (r,g,b は 0-255) の書き方をすることで 24bit 色の指定ができる。

::

  ESC [ 38;2;32;232;96 m        前景色を rgb=(32,232,96) の色にする
  ESC [ 48;2;32;232;96 m        背景色を rgb=(32,232,96) の色にする


実際にこのコードを投げても、端末エミュレータによっては、
256色カラーパレットの近い色を出すという実装もある。(TeraTermとか)



端末エミュレータの色に関する設定
----------------------------------------

たいていの端末エミュレータには、下記のような設定がある

- デフォルトの前景色
- デフォルトの背景色
- Normal(30番台)の8色
- Bright(90番台)の8色
- BoldをBright色で表現するかどうか

下記は、ANSI エスケープシーケンスとは関係ないが、
たいていの端末エミュレータにはこんな設定もある。

- カーソルの背景色
- カーソルが重なったときの文字色
- 選択範囲の背景色
- 選択範囲と重なったときの文字色
- 検索でマッチした部分の背景色
- リンクとみなした部分の文字色



各シェル・言語での対応
=============================


zsh
---------------

TODO
