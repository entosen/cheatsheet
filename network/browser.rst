===============================
ブラウザー
===============================



hosts反映、キャッシュ削除
==============================

hosts を切り替えたり、サーバ上のファイルを更新したりしたときの、
即時反映方法と確認方法についてまとめる。

どのブラウザも以下のような感じ

- 名前解決

    - hosts
    - DNS

- コネクションプール、Keep-alive 
- ブラウザによるコンテンツのキャッシュ


OSでのDNSのキャッシュ (Windows の場合)
----------------------------------------------

- hosts は保存したら即座に反映するっぽい 

  - hostsファイルを変更しながら、pingコマンドで確認した
  - ipconfig /displaydns で hosts に書いたエントリも出てくるが、即座に反映しているようだ。

- DNS

  - Windows 2000以降のWindowsプラットフォームでは，パフォーマンス向上のために，
    パソコン上でDNSのレコード情報をキャッシュするようになりました。
    これをDNSリゾルバ・キャッシュ(あるいは単にリゾルバ・キャッシュ)と呼びます。
    DNSサーバー側でレコードが更新されても，キャッシュが有効な間はそのパソコンでは
    リゾルバ・キャッシュに蓄積された古いIPアドレスとの対応情報を利用します。
  - クリア、確認方法::

        ipconfig /flushdns      # クリア
        ipconfig /displaydns    # 表示

  - キャシュ期間は DNS エントリの TTL に従う。(最大値の設定はある。24時間らしい)


ブラウザ内でのDNSキャッシュとソケットプール
--------------------------------------------------

観点は2つ

- 名前解決の結果をブラウザがキャッシュする
- ソケットをプールして使い回す (Keep-Alive？)

各ブラウザの挙動


- firefox

  - ブラウザ内にDNSキャッシュを持っている

    - これはしかも hosts のエントリもキャッシュするっぽい (60秒)
    - about:networking#dns で削除

  - ソケットに関しては、 IP で管理しているっぽいので、これのせいでhostsが反映しないということはなさそう。

    - about:networking#sockets

- Chrome

  - ::

        chrome://net-internals/#dns
        chrome://net-internals/#sockets

  - ここに表示されないので、詳細は不明。
  - あまり困ったことはないが、怪しいときは上記2つを削除

- IE

  - IE は hosts を書き換えたり、flushdns をしたりしても、IE11を再起動するまで反映してくれない。
  - 開発ツールでもIPアドレス表示してくれないので、確認もしづらい。



コンテンツのキャッシュ
-----------------------------------

スーパーリロード (キャッシュを無視する) ::

    Firefox
        Shift+更新ボタン,  Ctrl+Shift+R, Ctrl+F5
    chrome
        Ctrl+更新ボタン, Shift+更新ボタン,  Ctrl+F5, Shift+F5
    IE,Edge
        Ctrl+更新ボタン,   Ctrl+F5

    mac
        Command+R        (chrome, safari)
        Command+Shift+R  (Firefox)


キャッシュの削除

- Chrome

  - メニュー > 設定 > 詳細設定を表示 > プライバシーとセキュリティ
    > 閲覧履歴データの消去をする > キャッシュされた画像とファイル > データを消去

- Firefox

  - 本棚アイコン > 履歴 > 最近の履歴を消去 > 期間を選んで > キャッシュにだけチェックを入れて > OK

- IE11

  - ツール > インターネットオプション > 全般 > 削除 

- Edge

  - メニュー > 設定 > 閲覧データの削除 クリアするデータの選択 > キャッシュされたデータとファイル

- Mac Safari

  - Safariメニュー > 環境設定 > 詳細 > 開発メニューを表示
  - 開発メニュー > キャッシュを空にする

